var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{r as reactExports,a as reactDomExports,H,j as jsxRuntimeExports,b as joinClassNames,_ as __,N as NaverMap,M as Marker,l as l10nHelper,c as createRoot}from"./NaverMap-8e51bd0d.js";import{D as Description,N as Nonce}from"./Nonce-e2623a32.js";function r(e){var t,f,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=" "),n+=f);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}__name(r,"r");function clsx(){for(var e,t,f=0,n="";f<arguments.length;)(e=arguments[f++])&&(t=r(e))&&(n&&(n+=" "),n+=t);return n}__name(clsx,"clsx");var Y=reactExports.createContext({}),F=__name(()=>reactExports.useContext(Y),"F"),$=__name(t=>H.createElement(Y.Provider,{...t}),"$");function le(){let t=new Map;return{on(e,r2){return t.has(e)?t.get(e).add(r2):t.set(e,new Set([r2])),this},off(e,r2){return t.has(e)&&t.get(e).delete(r2),this},emit(e,r2){return t.has(e)&&t.get(e).forEach(f=>{f(r2)}),this}}}__name(le,"le");var R=le(),B=__name(()=>reactExports.useRef(new Map).current,"B"),z=__name(()=>{},"z"),U=["resize","contextmenu","click","scroll","blur"],A={show({event:t,id:e,props:r2,position:f}){t.preventDefault&&t.preventDefault(),R.emit(0).emit(e,{event:t.nativeEvent||t,props:r2,position:f})},hideAll(){R.emit(0)}};function Fe(t){return{show(e){A.show({...t,...e})},hideAll(){A.hideAll()}}}__name(Fe,"Fe");function G(){let t=new Map,e,r2,f,s,i=!1;function P(n){s=Array.from(n.values()),e=-1,f=!0}__name(P,"P");function v(){s[e].node.focus()}__name(v,"v");let x=__name(()=>e>=0&&s[e].isSubmenu,"x"),w=__name(()=>Array.from(s[e].submenuRefTracker.values()),"w");function m(){return e===-1?(b(),!1):!0}__name(m,"m");function b(){e+1<s.length?e++:e+1===s.length&&(e=0),i&&a(),v()}__name(b,"b");function E(){e===-1||e===0?e=s.length-1:e-1<s.length&&e--,i&&a(),v()}__name(E,"E");function T(){if(m()&&x()){let n=w(),{node:c,setSubmenuPosition:h}=s[e];return t.set(c,{isRoot:f,focusedIndex:e,parentNode:r2||c,items:s}),h(),c.classList.add("contexify_submenu-isOpen"),r2=c,n.length>0?(e=0,s=n):i=!0,f=!1,v(),!0}return!1}__name(T,"T");function a(){if(m()&&!f){let n=t.get(r2);r2.classList.remove("contexify_submenu-isOpen"),s=n.items,r2=n.parentNode,n.isRoot&&(f=!0,t.clear()),i||(e=n.focusedIndex,v())}}__name(a,"a");function y(n){function c(h){for(let o of h)o.isSubmenu&&o.submenuRefTracker&&c(Array.from(o.submenuRefTracker.values())),o.keyMatcher&&o.keyMatcher(n)}__name(c,"c"),c(s)}return __name(y,"y"),{init:P,moveDown:b,moveUp:E,openSubmenu:T,closeSubmenu:a,matchKeys:y}}__name(G,"G");function I(t){return typeof t=="function"}__name(I,"I");function V(t){return typeof t=="string"}__name(V,"V");function _(t,e){return reactExports.Children.map(reactExports.Children.toArray(t).filter(Boolean),r2=>reactExports.cloneElement(r2,e))}__name(_,"_");function J(t){let e={x:t.clientX,y:t.clientY},r2=t.changedTouches;return r2&&(e.x=r2[0].clientX,e.y=r2[0].clientY),(!e.x||e.x<0)&&(e.x=0),(!e.y||e.y<0)&&(e.y=0),e}__name(J,"J");function k(t,e){return I(t)?t(e):t}__name(k,"k");function be(t,e){return{...t,...I(e)?e(t):e}}__name(be,"be");var it=__name(({id:t,theme:e,style:r2,className:f,children:s,animation:i="fade",preventDefaultOnKeydown:P=!0,disableBoundariesCheck:v=!1,onVisibilityChange:x,...w})=>{let[m,b]=reactExports.useReducer(be,{x:0,y:0,visible:!1,triggerEvent:{},propsFromTrigger:null,willLeave:!1}),E=reactExports.useRef(null),T=B(),[a]=reactExports.useState(()=>G()),y=reactExports.useRef(),n=reactExports.useRef();reactExports.useEffect(()=>(R.on(t,h).on(0,o),()=>{R.off(t,h).off(0,o)}),[t,i,v]),reactExports.useEffect(()=>{m.visible?a.init(T):T.clear()},[m.visible,a,T]);function c(u,p){if(E.current&&!v){let{innerWidth:d,innerHeight:C}=window,{offsetWidth:K,offsetHeight:O}=E.current;u+K>d&&(u-=u+K-d),p+O>C&&(p-=p+O-C)}return{x:u,y:p}}__name(c,"c"),reactExports.useEffect(()=>{m.visible&&b(c(m.x,m.y))},[m.visible]),reactExports.useEffect(()=>{function u(d){P&&d.preventDefault()}__name(u,"u");function p(d){switch(d.key){case"Enter":case" ":a.openSubmenu()||o();break;case"Escape":o();break;case"ArrowUp":u(d),a.moveUp();break;case"ArrowDown":u(d),a.moveDown();break;case"ArrowRight":u(d),a.openSubmenu();break;case"ArrowLeft":u(d),a.closeSubmenu();break;default:a.matchKeys(d);break}}if(__name(p,"p"),m.visible){window.addEventListener("keydown",p);for(let d of U)window.addEventListener(d,o)}return()=>{window.removeEventListener("keydown",p);for(let d of U)window.removeEventListener(d,o)}},[m.visible,a,P]);function h({event:u,props:p,position:d}){u.stopPropagation();let C=d||J(u),{x:K,y:O}=c(C.x,C.y);reactDomExports.flushSync(()=>{b({visible:!0,willLeave:!1,x:K,y:O,triggerEvent:u,propsFromTrigger:p})}),clearTimeout(n.current),!y.current&&I(x)&&(x(!0),y.current=!0)}__name(h,"h");function o(u){u!=null&&(u.button===2||u.ctrlKey)&&u.type!=="contextmenu"||(i&&(V(i)||"exit"in i&&i.exit)?b(p=>({willLeave:p.visible})):b(p=>({visible:p.visible?!1:p.visible})),n.current=setTimeout(()=>{I(x)&&x(!1),y.current=!1}))}__name(o,"o");function M(){m.willLeave&&m.visible&&reactDomExports.flushSync(()=>b({visible:!1,willLeave:!1}))}__name(M,"M");function S(){return V(i)?clsx({[`contexify_willEnter-${i}`]:g&&!D,[`contexify_willLeave-${i} contexify_willLeave-'disabled'`]:g&&D}):i&&"enter"in i&&"exit"in i?clsx({[`contexify_willEnter-${i.enter}`]:i.enter&&g&&!D,[`contexify_willLeave-${i.exit} contexify_willLeave-'disabled'`]:i.exit&&g&&D}):null}__name(S,"S");let{visible:g,triggerEvent:l,propsFromTrigger:L,x:oe,y:ie,willLeave:D}=m,ae=clsx("contexify",f,{[`contexify_theme-${e}`]:e},S());return H.createElement($,{value:T},g&&H.createElement("div",{...w,className:ae,onAnimationEnd:M,style:{...r2,left:oe,top:ie,opacity:1},ref:E,role:"menu"},_(s,{propsFromTrigger:L,triggerEvent:l})))},"it"),pt=__name(({id:t,children:e,className:r2,style:f,triggerEvent:s,data:i,propsFromTrigger:P,keyMatcher:v,onClick:x=z,disabled:w=!1,hidden:m=!1,closeOnClick:b=!0,handlerEvent:E="onClick",...T})=>{let a=reactExports.useRef(),y=F(),n={id:t,data:i,triggerEvent:s,props:P},c=k(w,n),h=k(m,n);function o(l){n.event=l,l.stopPropagation(),c||(b?M():x(n))}__name(o,"o");function M(){let l=a.current;l.focus(),l.addEventListener("animationend",()=>setTimeout(A.hideAll),{once:!0}),l.classList.add("contexify_item-feedback"),x(n)}__name(M,"M");function S(l){l&&!c&&(a.current=l,y.set(l,{node:l,isSubmenu:!1,keyMatcher:!c&&I(v)&&(L=>{v(L)&&(L.stopPropagation(),L.preventDefault(),n.event=L,M())})}))}__name(S,"S");function g(l){(l.key==="Enter"||l.key===" ")&&(l.stopPropagation(),n.event=l,M())}return __name(g,"g"),h?null:H.createElement("div",{...T,[E]:o,className:clsx("contexify_item",r2,{"contexify_item-disabled":c}),style:f,onKeyDown:g,ref:S,tabIndex:-1,role:"menuitem","aria-disabled":c},H.createElement("div",{className:"contexify_itemContent"},e))},"pt");function Field(props){return jsxRuntimeExports.jsx("td",{...props,children:props.children})}__name(Field,"Field");function FormTable(props){const{children,className}=props;return jsxRuntimeExports.jsx("table",{className:`${joinClassNames("form-table",className)}`,...props,children:jsxRuntimeExports.jsx("tbody",{children})})}__name(FormTable,"FormTable");function Header(props){return jsxRuntimeExports.jsx("th",{scope:"row",...props,children:props.children})}__name(Header,"Header");function Row(props){return jsxRuntimeExports.jsx("tr",{...props,children:props.children})}__name(Row,"Row");const MENU_ID="edit-location";function EditLocation(props){const{show}=Fe({id:MENU_ID}),[map,setMap]=reactExports.useState(null),[data2,setData]=reactExports.useState(props.data),[isMarked,setMarked]=reactExports.useState(props.data.address.length>0);return reactExports.useEffect(()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},100)},[]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(FormTable,{children:[jsxRuntimeExports.jsxs(Row,{children:[jsxRuntimeExports.jsx(Header,{children:__("지도","shoplic-integration-for-naver-map")}),jsxRuntimeExports.jsxs(Field,{children:[jsxRuntimeExports.jsx(NaverMap,{id:"edit-map",className:`naver-map edit-map edit-map-${props.postId}`,mapOptions:{center:data2.coord,disableKineticPan:!1,tileTransition:!0},onClick:event=>{setData(prevState=>({...prevState,coord:{lat:event.coord.y,lng:event.coord.x}}))},ref:_map=>setMap(()=>_map),style:{height:"480px"},children:map&&data2.coord&&jsxRuntimeExports.jsx(Marker,{onRightClick:event=>{show({event:event.pointerEvent})},markerOptions:{map,position:data2.coord}})}),jsxRuntimeExports.jsx("p",{id:"coord-info",children:jsxRuntimeExports.jsxs("span",{children:[__("위도","shoplic-integration-for-naver-map"),": ",data2.coord.lat.toFixed(4),",",__("경도","shoplic-integration-for-naver-map"),": ",data2.coord.lng.toFixed(4)]})}),jsxRuntimeExports.jsx("input",{id:"nm-location-coord-lat",name:"nm_location_coord[lat]",type:"hidden",defaultValue:data2.coord.lat}),jsxRuntimeExports.jsx("input",{id:"nm-location-coord-lngt",name:"nm_location_coord[lng]",type:"hidden",defaultValue:data2.coord.lng}),jsxRuntimeExports.jsx(it,{id:MENU_ID,children:jsxRuntimeExports.jsx(pt,{id:"address",onClick:()=>{data2.address.length&&!confirm(__("주소가 입력되어 있습니다. 덮어쓸까요?","shoplic-integration-for-naver-map"))||naver.maps.Service.reverseGeocode({coords:new naver.maps.LatLng(data2.coord.lat,data2.coord.lng),orders:[naver.maps.Service.OrderType.ROAD_ADDR,naver.maps.Service.OrderType.ADDR].join(",")},(status,response)=>{if(naver.maps.Service.Status.ERROR===status)return alert("Something Wrong!");const{roadAddress,jibunAddress}=response.v2.address;if(roadAddress.length)setData(prevState=>({...prevState,address:roadAddress}));else if(jibunAddress.length)setData(prevState=>({...prevState,address:jibunAddress}));else return alert("Address not found.")})},children:__("이 위치의 주소를 입력","shoplic-integration-for-naver-map")})})]})]}),jsxRuntimeExports.jsxs(Row,{children:[jsxRuntimeExports.jsx(Header,{children:jsxRuntimeExports.jsx("label",{htmlFor:"nm-location-address",children:__("주소","shoplic-integration-for-naver-map")})}),jsxRuntimeExports.jsxs(Field,{children:[jsxRuntimeExports.jsxs("div",{className:"address-wrap",children:[jsxRuntimeExports.jsx("input",{className:"text",id:"nm-location-address",name:"nm_location_address",onChange:e=>{setData(prevState=>({...prevState,address:e.target.value}))},type:"text",value:data2.address}),jsxRuntimeExports.jsx("button",{className:"button button-primary",disabled:!data2.address.length||data2.address===props.data.address,type:"button",onClick:()=>{isMarked&&!confirm(__("주소를 다시 검색할까요?","shoplic-integration-for-naver-map"))||naver.maps.Service.geocode({query:data2.address},(status,response)=>{if(naver.maps.Service.Status.ERROR===status)return alert(__("주소 검색에 실패했습니다.","shoplic-integration-for-naver-map"));if(response.v2.meta.totalCount===0)return alert("totalCount"+response.v2.meta.totalCount);const coord={lat:parseFloat(response.v2.addresses[0].y),lng:parseFloat(response.v2.addresses[0].x)};setData(prevState=>({...prevState,coord})),map&&map.setCenter(coord),isMarked||setMarked(!0)})},children:"마커 이동"})]}),jsxRuntimeExports.jsx(Description,{children:__("상세한 주소는 직접 입력해야 될 수도 있습니다.","shoplic-integration-for-naver-map")})]})]}),jsxRuntimeExports.jsxs(Row,{children:[jsxRuntimeExports.jsx(Header,{children:jsxRuntimeExports.jsx("label",{htmlFor:"nm-location-telephone",children:__("전화번호","shoplic-integration-for-naver-map")})}),jsxRuntimeExports.jsxs(Field,{children:[jsxRuntimeExports.jsx("input",{className:"text large-text",id:"nm-location-telephone",name:"nm_location_telephone",onChange:e=>{const value=e.target.value.replace(/[^0-9\\-]/g,"");setData(prevState=>({...prevState,telephone:value}))},placeholder:"000-0000-0000",type:"tel",value:data2.telephone}),jsxRuntimeExports.jsx(Description,{children:__("이 위치의 전화번호. 전화기에서 이 장소로 전화를 걸 때 사용될 수 있습니다.","shoplic-integration-for-naver-map")})]})]}),jsxRuntimeExports.jsxs(Row,{children:[jsxRuntimeExports.jsx(Header,{children:jsxRuntimeExports.jsx("label",{htmlFor:"nm-location-url",children:__("URL","shoplic-integration-for-naver-map")})}),jsxRuntimeExports.jsxs(Field,{children:[jsxRuntimeExports.jsx("input",{className:"text large-text",id:"nm-location-url",name:"nm_location_url",onChange:e=>{setData(prevState=>({...prevState,url:e.target.value}))},placeholder:"https://....",type:"text",value:data2.url}),jsxRuntimeExports.jsx(Description,{children:__("이 위치와 관련된 URL.","shoplic-integration-for-naver-map")})]})]}),jsxRuntimeExports.jsxs(Row,{children:[jsxRuntimeExports.jsx(Header,{children:jsxRuntimeExports.jsx("label",{htmlFor:"",children:__("대체 제목","shoplic-integration-for-naver-map")})}),jsxRuntimeExports.jsxs(Field,{children:[jsxRuntimeExports.jsx("input",{className:"text large-text",id:"nm-location-alt-title",name:"nm_location_alt_title",onChange:e=>{setData(prevState=>({...prevState,alt_title:e.target.value}))},type:"text",value:data2.alt_title}),jsxRuntimeExports.jsx(Description,{children:__("지도에서 대신 사용할 제목입니다. 비워두면 포스트 제목을 사용합니다.","shoplic-integration-for-naver-map")})]})]})]}),jsxRuntimeExports.jsx(Nonce,{id:"nm-location-nonce",name:"nm_location_nonce",defaultValue:props.nonce})]})}__name(EditLocation,"EditLocation");const{data,nonce,post_id}=nmEditLocation;console.log("nmEditLocation",nmEditLocation);const root=document.getElementById("nm-edit-location");root?(l10nHelper("shoplic-integration-for-naver-map"),createRoot(root).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(EditLocation,{data,nonce,postId:parseInt(post_id)})}))):console.error("#nm-edit-location not found!");
//# sourceMappingURL=edit-location-e868fec9.js.map
